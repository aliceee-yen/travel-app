<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 è·¨åœ‹å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-paper: #fffdf5; --ink: #2c2c2c; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-paper); color: var(--ink); -webkit-tap-highlight-color: transparent; padding-bottom: 100px; }
        .font-header { font-family: 'ZCOOL KuaiLe', cursive; }
        
        /* æ‰‹ç¹ªé¢¨æ ¼ */
        .sketch-box { 
            background: white; 
            border: 2px solid var(--ink); 
            border-radius: 6px;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .sketch-btn {
            border: 2px solid var(--ink);
            box-shadow: 2px 2px 0px rgba(0,0,0,1);
            transition: all 0.1s;
        }
        .sketch-btn:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0px rgba(0,0,0,1); }
        
        /* Checkbox */
        .custom-checkbox { width: 1rem; height: 1rem; accent-color: var(--ink); }
        .checked-item { text-decoration: line-through; color: #9ca3af; }

        /* ç…§ç‰‡ä¹å®®æ ¼ */
        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
        .photo-item { aspect-ratio: 1/1; border: 2px solid var(--ink); border-radius: 4px; overflow: hidden; position: relative; background: #eee; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .photo-del { position: absolute; top: 2px; right: 2px; background: rgba(0,0,0,0.6); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; }

        /* Tab Animation */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
    </style>
</head>
<body>

    <header class="bg-white border-b-2 border-gray-800 pt-12 pb-3 px-4 sticky top-0 z-40 flex justify-between items-center shadow-sm">
        <div>
            <h1 class="text-xl font-header tracking-wider">ğŸ¦• è·¨åœ‹å†’éšª 2026</h1>
            <div class="text-[10px] text-gray-400 font-bold">YUNLIN â” BUSAN â” KYUSHU</div>
        </div>
        <button onclick="resetData()" class="text-[10px] text-gray-300 border px-2 py-1 rounded">é‡ç½®</button>
    </header>

    <main class="p-4 max-w-lg mx-auto">
        
        <section id="plan" class="tab-content active">
            <div class="flex overflow-x-auto gap-2 pb-2 mb-2 no-scrollbar" id="dayNav"></div>

            <div id="weatherBoard" class="mb-3 bg-blue-50 p-2 rounded border border-blue-100 flex justify-between items-center hidden">
                <div class="flex items-center gap-2">
                    <div id="w-icon" class="text-xl">â›…</div>
                    <div class="flex items-baseline gap-1">
                        <span id="w-city" class="text-[10px] font-bold text-gray-400 uppercase">LOC</span>
                        <span id="w-temp" class="text-lg font-black text-gray-800">--</span>
                        <span class="text-xs">Â°C</span>
                    </div>
                </div>
                <div id="w-desc" class="text-[10px] font-bold text-blue-600 bg-white px-2 py-0.5 rounded">æ›´æ–°ä¸­</div>
            </div>

            <div id="dailyContainer" class="space-y-3"></div>
            
            <button onclick="openEditModal()" class="w-full mt-4 mb-6 py-2 border-2 border-dashed border-gray-300 text-gray-400 rounded text-sm font-bold hover:border-gray-800 hover:text-gray-800">
                <i class="fa-solid fa-plus"></i> æ–°å¢è¡Œç¨‹
            </button>

            <div class="sketch-box p-3 bg-gray-50 mt-6 relative">
                <div class="absolute -top-3 left-3 bg-green-500 text-white text-[10px] px-2 py-0.5 rounded font-bold border border-black shadow-sm">
                    ğŸ“… ä»Šæ—¥æ¶ˆè²»
                </div>
                <div class="flex justify-between items-end mb-2 mt-1">
                    <div class="text-xs text-gray-400">ç•¶æ—¥ç¸½è¨ˆ</div>
                    <div class="text-lg font-black text-green-700" id="dailyTotalDisplay">NT$ 0</div>
                </div>
                
                <div class="flex gap-2 mb-2">
                    <input id="quickExpDesc" type="text" placeholder="å“é …" class="flex-1 p-2 border-2 border-gray-300 rounded text-sm outline-none focus:border-black">
                    <select id="quickExpCurr" class="p-1 border-2 border-gray-300 rounded text-xs bg-white font-bold outline-none focus:border-black">
                        <option value="KR">â‚©</option>
                        <option value="JP">Â¥</option>
                    </select>
                    <input id="quickExpAmt" type="number" placeholder="é‡‘é¡" class="w-20 p-2 border-2 border-gray-300 rounded text-sm outline-none focus:border-black">
                    <button onclick="addExpenseFromPlan()" class="bg-black text-white px-3 rounded text-sm hover:bg-gray-800"><i class="fa-solid fa-plus"></i></button>
                </div>
                
                <div id="dailyExpenseList" class="space-y-1 text-sm text-gray-600 pl-1"></div>
            </div>
        </section>

        <section id="shopping" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-yellow-400">ğŸ›ï¸ å¿…è²·æ¸…å–®</h2>
            
            <div class="mb-6">
                <div class="flex gap-2 mb-2">
                    <input id="shopInput" type="text" placeholder="è¼¸å…¥æ–‡å­—é …ç›®..." class="flex-1 p-2 sketch-box outline-none text-sm">
                    <button onclick="addShopItem()" class="bg-yellow-400 px-3 rounded sketch-btn font-bold text-sm"><i class="fa-solid fa-pen"></i></button>
                </div>
                <div id="shopList" class="space-y-1 max-h-40 overflow-y-auto"></div> 
            </div>

            <hr class="border-dashed border-gray-300 mb-4">

            <div>
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-sm text-gray-500"><i class="fa-regular fa-image"></i> æˆªåœ–/ç…§ç‰‡ç‰†</h3>
                    <label class="bg-gray-800 text-white px-3 py-1 rounded text-xs cursor-pointer shadow active:scale-95">
                        <i class="fa-solid fa-camera"></i> æ–°å¢åœ–ç‰‡
                        <input type="file" id="imgInput" accept="image/*" class="hidden" onchange="handleAddImage()">
                    </label>
                </div>
                <div id="imageGrid" class="photo-grid">
                    </div>
            </div>
        </section>

        <section id="wallet" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-green-500">ğŸ’° åŒ¯ç‡è¨ˆç®—æ©Ÿ</h2>
            
            <div class="bg-gray-800 text-white p-5 rounded-xl shadow-lg mb-6 relative">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-xs font-bold text-gray-400">è³¼ç‰©è©¦ç®— (ä¸ç´€éŒ„)</span>
                    <div class="flex bg-gray-700 rounded p-1 gap-1">
                        <button onclick="setCurrency('KR')" id="btn-calc-kr" class="text-xs px-3 py-1 rounded bg-blue-500 text-white transition-all">éŸ“å¹£</button>
                        <button onclick="setCurrency('JP')" id="btn-calc-jp" class="text-xs px-3 py-1 rounded text-gray-300 transition-all">æ—¥å¹£</button>
                    </div>
                </div>
                <div class="flex items-baseline gap-2">
                    <span class="text-2xl font-mono text-gray-400" id="currencySymbol">â‚©</span>
                    <input id="calcInput" type="number" class="bg-transparent text-5xl font-bold w-full outline-none text-white placeholder-gray-600" placeholder="0">
                </div>
                <div class="mt-4 pt-3 border-t border-gray-600 text-right">
                    <div class="text-xs text-gray-400 mb-1">ç´„å°å¹£</div>
                    <div class="text-green-400 font-bold text-3xl">NT$ <span id="calcResult">0</span></div>
                </div>
            </div>
            
            <div class="text-center text-xs text-gray-400">
                * æ¯æ—¥è¨˜å¸³è«‹è‡³ã€Œè¡Œç¨‹ã€é é¢ä¸‹æ–¹ä½¿ç”¨<br>
                * åŒ¯ç‡è¨­å®šï¼š1 éŸ“å¹£ = 0.024 å°å¹£ / 1 æ—¥å¹£ = 0.22 å°å¹£
            </div>
        </section>

        <section id="translate" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-purple-500">ğŸ—£ï¸ ç¿»è­¯å°å¹«æ‰‹</h2>

            <div class="relative mb-4">
                <input id="transInput" type="text" placeholder="è¼¸å…¥ä¸­æ–‡å¿«é€ŸæŸ¥è©¢..." 
                    class="w-full p-3 pr-16 sketch-box outline-none text-sm bg-purple-50 focus:bg-white transition-colors">
                <button onclick="quickTranslate()" 
                    class="absolute right-1.5 top-1.5 bottom-1.5 bg-purple-600 text-white px-3 rounded font-bold text-xs shadow hover:bg-purple-700 active:scale-95 transition-all">
                    GO
                </button>
            </div>

            <div class="flex gap-2 mb-3">
                <button onclick="renderPhrases('KR')" id="btn-lang-kr" class="flex-1 py-1.5 rounded text-sm font-bold border bg-blue-100 text-blue-800">ğŸ‡°ğŸ‡· éŸ“èª</button>
                <button onclick="renderPhrases('JP')" id="btn-lang-jp" class="flex-1 py-1.5 rounded text-sm font-bold border bg-white text-gray-400">ğŸ‡¯ğŸ‡µ æ—¥èª</button>
            </div>
            <div id="phraseList" class="space-y-2"></div>
        </section>

        <section id="info" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-gray-500">â„¹ï¸ å¯¦ç”¨ç­†è¨˜</h2>
            <div id="infoList" class="space-y-3"></div>
            <button onclick="addInfoItem()" class="w-full mt-4 py-2 border border-gray-300 text-gray-400 rounded text-sm hover:bg-gray-50"><i class="fa-solid fa-plus"></i> æ–°å¢ç­†è¨˜</button>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 flex justify-around items-center py-2 pb-6 z-50 text-[10px]">
        <button onclick="switchTab('plan')" class="nav-btn text-gray-800 w-1/5 flex flex-col items-center p-2"><i class="fa-solid fa-map-location-dot text-xl mb-1"></i><b>è¡Œç¨‹</b></button>
        <button onclick="switchTab('shopping')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2"><i class="fa-solid fa-cart-shopping text-xl mb-1"></i><b>å¾…è³¼</b></button>
        <button onclick="switchTab('wallet')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2"><i class="fa-solid fa-calculator text-xl mb-1"></i><b>æ›ç®—</b></button>
        <button onclick="switchTab('translate')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2"><i class="fa-solid fa-language text-xl mb-1"></i><b>ç¿»è­¯</b></button>
        <button onclick="switchTab('info')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2"><i class="fa-solid fa-circle-info text-xl mb-1"></i><b>è³‡è¨Š</b></button>
    </nav>

    <div id="editModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-5 rounded-lg shadow-2xl border-2 border-gray-800">
            <h3 class="font-header text-lg mb-3" id="modalTitle">ç·¨è¼¯è¡Œç¨‹</h3>
            <input type="hidden" id="editIndex">
            <div class="space-y-3">
                <input id="modalTime" type="time" class="w-full p-2 border rounded bg-gray-50">
                <input id="modalAct" type="text" placeholder="æ¨™é¡Œ (åœ°åœ–æœå°‹é—œéµå­—)" class="w-full p-2 border rounded">
                <textarea id="modalNote" rows="3" placeholder="å‚™è¨»..." class="w-full p-2 border rounded"></textarea>
            </div>
            <div class="flex gap-2 mt-4">
                <button onclick="closeModal()" class="flex-1 py-2 bg-gray-100 rounded text-gray-500 text-sm">å–æ¶ˆ</button>
                <button onclick="saveItem()" class="flex-1 py-2 bg-gray-800 text-white rounded font-bold text-sm">å„²å­˜</button>
            </div>
            <button onclick="deleteItem()" id="btnDelete" class="w-full mt-2 text-red-500 text-xs py-2 hidden">åˆªé™¤</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™ ---
        const defaultTrip = [
            { d: "D0", date: "2/13", city: "Yunlin", lat: 23.7, lon: 120.4, country: "TW", items: [{ time: "21:30", act: "é›²æ—è™å°¾å‡ºç™¼", note: "é ç´„è¨ˆç¨‹è»Š" }, { time: "22:16", act: "é›²æ—é«˜éµ", note: "æœ«ç­è»Š" }]},
            { d: "D1", date: "2/14", city: "Busan", lat: 35.17, lon: 129.07, country: "KR", items: [{ time: "06:10", act: "é‡‘æµ·æ©Ÿå ´", note: "æ›éŒ¢/Q-CODE" }, { time: "08:00", act: "æ¾äº­ä¸‰ä»£è±¬è‚‰æ¹¯é£¯", note: "è¥¿é¢å¸‚å ´" }]},
            { d: "D2", date: "2/15", city: "Busan", lat: 35.17, lon: 129.07, country: "KR", items: [{ time: "10:30", act: "å¤©ç©ºè† å›Šåˆ—è»Š", note: "å°¾æµ¦å‡ºç™¼" }, { time: "13:00", act: "æµ·ç†åœ˜è·¯", note: "é€›è¡—" }]},
            { d: "D3", date: "2/16", city: "Busan", lat: 35.1, lon: 129.0, country: "KR", items: [{ time: "09:30", act: "ç”˜å·æ´æ–‡åŒ–æ‘", note: "å°ç‹å­" }, { time: "17:00", act: "é‡œå±±æ¸¯ç™»èˆ¹", note: "æ–°å±±èŒ¶èŠ±è™Ÿ" }]},
            { d: "D4", date: "2/17", city: "Nagasaki", lat: 32.75, lon: 129.87, country: "JP", items: [{ time: "09:00", act: "åšå¤šè»Šç«™", note: "è²·ç¥¨" }, { time: "11:30", act: "é•·å´", note: "Check-in" }]},
            { d: "D5", date: "2/18", city: "Nagasaki", lat: 32.75, lon: 129.87, country: "JP", items: [{ time: "10:15", act: "ä¼éµæ°´æ—é¤¨", note: "æ­å·´å£«" }, { time: "17:15", act: "çœ¼é¡æ©‹", note: "æ‰¾æ„›å¿ƒçŸ³" }]},
            { d: "D6", date: "2/19", city: "Hita", lat: 33.32, lon: 130.93, country: "JP", items: [{ time: "08:30", act: "NIPPON å–è»Š", note: "æª¢æŸ¥é›ªèƒ" }, { time: "17:00", act: "å¤©ç€¨æº«æ³‰", note: "æºªä»™é–£" }]},
            { d: "D7", date: "2/20", city: "Yufu", lat: 33.26, lon: 131.36, country: "JP", items: [{ time: "09:40", act: "ä¹å·è‡ªç„¶å‹•ç‰©åœ’", note: "Jungle Bus" }, { time: "15:45", act: "é‡‘é±—æ¹–", note: "æ™¨éœ§" }]},
            { d: "D8", date: "2/21", city: "Oita", lat: 33.23, lon: 131.61, country: "JP", items: [{ time: "12:30", act: "è±å¾ŒèŒ¶å±‹", note: "å¤©å©¦ç¾…" }, { time: "16:30", act: "å¤§åˆ†æ©Ÿå ´", note: "å›å°ç£" }]}
        ];
        const defaultInfo = [
            { id: 1, title: "æ—¥æœ¬å ±è­¦", text: "110 (æ•‘è­· 119)", color: "bg-red-50" },
            { id: 2, title: "éŸ“åœ‹å ±è­¦", text: "112 (æ•‘è­· 119)", color: "bg-blue-50" },
            { id: 3, title: "æ—¥æœ¬åŠ æ²¹", text: "Regular Man-tan (ç´…)", color: "bg-gray-50" },
            { id: 4, title: "æ—¥æœ¬å°èˆª", text: "è«‹å¹«æˆ‘è¨­ MapCode", color: "bg-gray-50" }
        ];
        const phrases = { KR: [{t:"ä½ å¥½",o:"ì•ˆë…•í•˜ì„¸ìš”"},{t:"è¬è¬",o:"ê°ì‚¬í•©ë‹ˆë‹¤"},{t:"å¤šå°‘éŒ¢?",o:"ì–¼ë§ˆì˜ˆìš”?"},{t:"å»æ‰€?",o:"í™”ì¥ì‹¤?"},{t:"ä¸è¾£",o:"ì•ˆ ë§µê²Œ"}], JP: [{t:"ä½ å¥½",o:"ã“ã‚“ã«ã¡ã¯"},{t:"è¬è¬",o:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™"},{t:"å¤šå°‘éŒ¢?",o:"ã„ãã‚‰ã§ã™ã‹"},{t:"å»æ‰€?",o:"ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹"},{t:"åŠ æ»¿æ²¹",o:"ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³"}] };
        
        const RATES = { 'KR': 0.024, 'JP': 0.22, 'TW': 1 };
        let tripData = [], infoData = [];
        let curDay = 0, curLang = 'KR', curRate = 0.024;

        function init() {
            tripData = getStorage('trip_data_2026_v6', defaultTrip);
            infoData = getStorage('trip_info_2026_v6', defaultInfo);
            renderDayNav(); renderDaily(0); renderShopList(); renderShopImages(); renderInfoList(); renderPhrases('KR');
            document.getElementById('calcInput').addEventListener('input', (e) => { document.getElementById('calcResult').innerText = Math.round(e.target.value * curRate).toLocaleString(); });
        }

        // --- 1. è¡Œç¨‹ & è¨˜å¸³ ---
        function renderDayNav() {
            document.getElementById('dayNav').innerHTML = tripData.map((d, i) => `
                <button onclick="renderDaily(${i})" class="flex-shrink-0 px-3 py-1.5 rounded text-xs font-bold border transition-all ${i === curDay ? 'bg-gray-800 text-white border-gray-800' : 'bg-white text-gray-400 border-gray-200'}">${d.d} ${d.date}</button>
            `).join('');
        }
        function renderDaily(idx) {
            curDay = idx; renderDayNav();
            const day = tripData[idx];
            fetchWeather(day.lat, day.lon, day.city);
            
            // è‡ªå‹•åˆ‡æ›
            if(day.country==='JP'){ setCurrency('JP'); renderPhrases('JP'); document.getElementById('quickExpCurr').value='JP'; }
            if(day.country==='KR'){ setCurrency('KR'); renderPhrases('KR'); document.getElementById('quickExpCurr').value='KR'; }

            document.getElementById('dailyContainer').innerHTML = day.items.map((item, i) => `
                <div class="sketch-box p-3 relative bg-white" onclick="openEditModal(${i})">
                    <div class="flex justify-between items-start mb-1"><span class="bg-yellow-300 text-[10px] font-black px-1.5 py-0.5 rounded border border-black">${item.time}</span></div>
                    <div class="text-base font-bold text-blue-700 underline decoration-blue-300 underline-offset-4 cursor-pointer mb-1" onclick="event.stopPropagation(); openMap('${item.act}', '${day.country}')">${item.act} <i class="fa-solid fa-arrow-up-right-from-square text-[10px]"></i></div>
                    <div class="text-xs text-gray-500 bg-gray-50 p-1.5 rounded">${item.note}</div>
                </div>
            `).join('');
            renderDailyExpenses();
        }
        function addExpenseFromPlan() {
            const desc = document.getElementById('quickExpDesc').value;
            const amt = document.getElementById('quickExpAmt').value;
            const curr = document.getElementById('quickExpCurr').value;
            if(!desc || !amt) return;
            const list = getStorage('trip_wallet_v6', []);
            list.push({ d: desc, a: amt, c: curr, date: tripData[curDay].date });
            saveStorage('trip_wallet_v6', list);
            document.getElementById('quickExpDesc').value = ''; document.getElementById('quickExpAmt').value = '';
            renderDailyExpenses();
        }
        function renderDailyExpenses() {
            const list = getStorage('trip_wallet_v6', []).filter(i => i.date === tripData[curDay].date);
            const total = list.reduce((sum, item) => sum + Math.round(item.a * RATES[item.c]), 0);
            document.getElementById('dailyTotalDisplay').innerText = `â‰ˆ NT$ ${total.toLocaleString()}`;
            document.getElementById('dailyExpenseList').innerHTML = list.length===0 ? '<div class="text-xs text-gray-300 text-center py-2">æœ¬æ—¥å°šç„¡ç´€éŒ„</div>' : list.map((item, idx) => `
                <div class="flex justify-between items-center border-b border-gray-100 py-1 last:border-0">
                    <span class="truncate pr-2">${item.d}</span>
                    <div class="flex items-center gap-2 whitespace-nowrap">
                        <span class="font-mono text-xs">${item.c==='KR'?'â‚©':'Â¥'}${item.a}</span>
                        <button onclick="delExpense('${item.date}', '${item.d}', ${item.a})" class="text-gray-300 hover:text-red-500 px-1"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>
            `).join('');
        }
        function delExpense(date, desc, amt) {
            if(!confirm('åˆªé™¤?')) return;
            let list = getStorage('trip_wallet_v6', []);
            const idx = list.findIndex(i => i.date === date && i.d === desc && i.a == amt);
            if(idx > -1) { list.splice(idx, 1); saveStorage('trip_wallet_v6', list); renderDailyExpenses(); }
        }

        // --- 2. å¾…è³¼æ¸…å–® (æ–‡å­— + åœ–ç‰‡) ---
        function addShopItem() {
            const input = document.getElementById('shopInput');
            if(!input.value.trim()) return;
            const list = getStorage('trip_shop_v6', []);
            list.push({id: Date.now(), txt: input.value, done: false});
            saveStorage('trip_shop_v6', list);
            input.value = ''; renderShopList();
        }
        function renderShopList() {
            const list = getStorage('trip_shop_v6', []);
            document.getElementById('shopList').innerHTML = list.map(i => `
                <div class="flex items-center bg-white p-2 border-b border-gray-100">
                    <input type="checkbox" class="custom-checkbox mr-3" onchange="toggleShop(${i.id})" ${i.done?'checked':''}>
                    <div class="flex-1 text-sm ${i.done?'checked-item':''}">${i.txt}</div>
                    <button onclick="delShop(${i.id})" class="text-gray-300 hover:text-red-500 px-2"><i class="fa-solid fa-trash text-xs"></i></button>
                </div>
            `).join('');
        }
        function toggleShop(id) { const list = getStorage('trip_shop_v6', []); const item = list.find(i => i.id === id); if(item) item.done = !item.done; saveStorage('trip_shop_v6', list); renderShopList(); }
        function delShop(id) { const list = getStorage('trip_shop_v6', []).filter(i => i.id !== id); saveStorage('trip_shop_v6', list); renderShopList(); }
        
        // åœ–ç‰‡è™•ç†
        function handleAddImage() {
            const file = document.getElementById('imgInput').files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxWidth = 300; // å£“ç¸®
                    const scale = maxWidth / img.width;
                    canvas.width = maxWidth;
                    canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const base64 = canvas.toDataURL('image/jpeg', 0.7);
                    
                    const list = getStorage('trip_shop_img_v6', []);
                    list.push({id: Date.now(), src: base64});
                    saveStorage('trip_shop_img_v6', list);
                    renderShopImages();
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
        function renderShopImages() {
            const list = getStorage('trip_shop_img_v6', []);
            document.getElementById('imageGrid').innerHTML = list.map(i => `
                <div class="photo-item">
                    <img src="${i.src}">
                    <button class="photo-del" onclick="delImage(${i.id})">âœ•</button>
                </div>
            `).join('');
        }
        function delImage(id) { if(confirm('åˆªé™¤ç…§ç‰‡?')) { const list = getStorage('trip_shop_img_v6', []).filter(i => i.id !== id); saveStorage('trip_shop_img_v6', list); renderShopImages(); } }

        // --- 3. å…¶ä»–åŠŸèƒ½ (åŒ¯ç‡/ç¿»è­¯/è³‡è¨Š) ---
        function setCurrency(c) {
            curLang = c; curRate = RATES[c];
            document.getElementById('currencySymbol').innerText = c === 'KR' ? 'â‚©' : 'Â¥';
            document.getElementById('calcInput').value = ''; document.getElementById('calcResult').innerText = '0';
            const bKR = document.getElementById('btn-calc-kr'), bJP = document.getElementById('btn-calc-jp');
            if(c==='KR'){ bKR.classList.replace('text-gray-300','bg-blue-500'); bKR.classList.add('text-white'); bJP.className="text-xs px-3 py-1 rounded text-gray-300 transition-all"; }
            else { bJP.classList.replace('text-gray-300','bg-red-500'); bJP.classList.add('text-white'); bKR.className="text-xs px-3 py-1 rounded text-gray-300 transition-all"; }
        }
        function renderPhrases(lang) {
            curLang = lang;
            const list = phrases[lang];
            document.getElementById('btn-lang-kr').className = lang==='KR' ? 'flex-1 py-1.5 rounded text-sm font-bold border bg-blue-100 text-blue-800' : 'flex-1 py-1.5 rounded text-sm font-bold border bg-white text-gray-400';
            document.getElementById('btn-lang-jp').className = lang==='JP' ? 'flex-1 py-1.5 rounded text-sm font-bold border bg-red-100 text-red-800' : 'flex-1 py-1.5 rounded text-sm font-bold border bg-white text-gray-400';
            document.getElementById('phraseList').innerHTML = list.map(p => `
                <div class="bg-white p-2 rounded border border-gray-200 shadow-sm flex justify-between items-center">
                    <div><div class="text-[10px] text-gray-400 font-bold">${p.t}</div><div class="text-base font-bold text-gray-800">${p.o}</div></div>
                    <button onclick="quickTranslate('${p.o}')" class="text-gray-400 p-2"><i class="fa-solid fa-volume-high"></i></button>
                </div>
            `).join('');
        }
        function quickTranslate(txt) {
            const input = document.getElementById('transInput').value; const q = txt || input; if(!q) return;
            window.open(`https://translate.google.com/?sl=auto&tl=${curLang==='KR'?'ko':'ja'}&text=${encodeURIComponent(q)}&op=translate`, '_blank');
        }
        function renderInfoList() {
            document.getElementById('infoList').innerHTML = infoData.map((item, idx) => `
                <div class="sketch-box p-3 ${item.color || 'bg-white'} flex justify-between items-center">
                    <div><div class="text-xs text-gray-500">${item.title}</div><div class="text-lg font-black text-gray-800">${item.text}</div></div>
                    <button onclick="delInfo(${idx})" class="text-gray-300 hover:text-red-500 px-2"><i class="fa-solid fa-trash text-xs"></i></button>
                </div>
            `).join('');
        }
        function addInfoItem() { const title = prompt("æ¨™é¡Œ"); if(!title) return; const text = prompt("å…§å®¹"); if(!text) return; infoData.push({ title, text, color: 'bg-white' }); saveStorage('trip_info_2026_v6', infoData); renderInfoList(); }
        function delInfo(idx) { if(!confirm('åˆªé™¤?')) return; infoData.splice(idx, 1); saveStorage('trip_info_2026_v6', infoData); renderInfoList(); }
        function openMap(key, country) { const cleanKey = key.split(/[(ï¼ˆ]/)[0]; window.open(country === 'KR' ? `https://map.naver.com/p/search/${cleanKey}` : `https://www.google.com/maps/search/?api=1&query=${cleanKey}`, '_blank'); }
        async function fetchWeather(lat, lon, city) {
            document.getElementById('w-city').innerText = city; document.getElementById('w-desc').innerText = 'æ›´æ–°ä¸­'; document.getElementById('weatherBoard').classList.remove('hidden');
            try { const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`); const d = await r.json(); document.getElementById('w-temp').innerText = Math.round(d.current_weather.temperature); document.getElementById('w-desc').innerText = 'å³æ™‚'; } catch(e){ document.getElementById('w-desc').innerText = 'é›¢ç·š'; }
        }

        // Shared
        function getStorage(k, d) { return JSON.parse(localStorage.getItem(k)) || JSON.parse(JSON.stringify(d)); }
        function saveStorage(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
        function switchTab(id) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('text-gray-800'); b.classList.add('text-gray-400'); }); event.currentTarget.classList.remove('text-gray-400'); event.currentTarget.classList.add('text-gray-800'); window.scrollTo(0,0); }
        function openEditModal(i=-1) { document.getElementById('editModal').classList.remove('hidden'); document.getElementById('editIndex').value = i; if(i===-1) { document.getElementById('modalTitle').innerText="æ–°å¢"; document.getElementById('btnDelete').classList.add('hidden'); document.getElementById('modalTime').value="09:00"; document.getElementById('modalAct').value=""; document.getElementById('modalNote').value=""; } else { const item = tripData[curDay].items[i]; document.getElementById('modalTitle').innerText="ç·¨è¼¯"; document.getElementById('btnDelete').classList.remove('hidden'); document.getElementById('modalTime').value=item.time; document.getElementById('modalAct').value=item.act; document.getElementById('modalNote').value=item.note; } }
        function closeModal() { document.getElementById('editModal').classList.add('hidden'); }
        function saveItem() { const idx = parseInt(document.getElementById('editIndex').value); const item = { time: document.getElementById('modalTime').value, act: document.getElementById('modalAct').value, note: document.getElementById('modalNote').value }; if(!item.act) return; if(idx===-1) tripData[curDay].items.push(item); else tripData[curDay].items[idx]=item; tripData[curDay].items.sort((a,b)=>a.time.localeCompare(b.time)); saveStorage('trip_data_2026_v6', tripData); renderDaily(curDay); closeModal(); }
        function deleteItem() { const idx = parseInt(document.getElementById('editIndex').value); if(confirm('åˆªé™¤?')) { tripData[curDay].items.splice(idx,1); saveStorage('trip_data_2026_v6', tripData); renderDaily(curDay); closeModal(); } }
        function resetData() { if(confirm('é‡ç½®è³‡æ–™?')) { localStorage.clear(); location.reload(); } }

        init();
    </script>
</body>
</html>
