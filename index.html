<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 è·¨åœ‹è¦ªå­å¤§å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-paper: #fffdf5; --ink: #2c2c2c; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-paper); color: var(--ink); -webkit-tap-highlight-color: transparent; padding-bottom: 110px; }
        .font-header { font-family: 'ZCOOL KuaiLe', cursive; }
        
        /* æ‰‹ç¹ªé¢¨æ ¼å…ƒä»¶ */
        .sketch-box { 
            background: white; 
            border: 2px solid var(--ink); 
            border-radius: 8px;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }
        .sketch-btn {
            border: 2px solid var(--ink);
            box-shadow: 2px 2px 0px rgba(0,0,0,1);
            transition: all 0.1s;
        }
        .sketch-btn:active { transform: translate(2px, 2px); box-shadow: none; }
        
        /* Checkbox è‡ªè¨‚ */
        .custom-checkbox { width: 1.2rem; height: 1.2rem; accent-color: var(--ink); }
        .checked-item { text-decoration: line-through; color: #9ca3af; }

        /* åˆ†é åˆ‡æ› */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* éš±è—å·è»¸ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
    </style>
</head>
<body>

    <header class="bg-white border-b-2 border-gray-800 pt-12 pb-3 px-4 sticky top-0 z-40 flex justify-between items-center shadow-sm">
        <div>
            <h1 class="text-xl font-header tracking-wider">ğŸ¦• è·¨åœ‹å†’éšª 2026</h1>
            <div class="text-[10px] text-gray-500 font-bold">YUNLIN â” BUSAN â” KYUSHU</div>
        </div>
        <button onclick="resetData()" class="text-xs text-gray-400 px-2">é‡ç½®</button>
    </header>

    <main class="p-4 max-w-lg mx-auto">
        
        <section id="plan" class="tab-content active">
            <div class="flex overflow-x-auto gap-2 pb-2 mb-4 no-scrollbar" id="dayNav"></div>

            <div id="weatherBoard" class="mb-4 bg-blue-50 p-3 rounded-lg border border-blue-100 flex justify-between items-center hidden">
                <div class="flex items-center gap-3">
                    <div id="w-icon" class="text-3xl">â›…</div>
                    <div>
                        <div id="w-city" class="text-[10px] font-bold text-gray-400 uppercase">LOCATION</div>
                        <div class="flex items-baseline gap-1">
                            <span id="w-temp" class="text-2xl font-black text-gray-800">--</span>
                            <span class="text-sm">Â°C</span>
                        </div>
                    </div>
                </div>
                <div id="w-desc" class="text-xs font-bold text-blue-600 bg-white px-2 py-1 rounded">æ›´æ–°ä¸­...</div>
            </div>

            <div id="dailyContainer" class="space-y-4"></div>
            
            <button onclick="openEditModal()" class="w-full mt-6 py-3 border-2 border-dashed border-gray-300 text-gray-400 rounded-lg font-bold hover:border-gray-800 hover:text-gray-800 transition-colors">
                <i class="fa-solid fa-plus"></i> æ–°å¢è¡Œç¨‹
            </button>
        </section>

        <section id="shopping" class="tab-content">
            <h2 class="font-header text-xl mb-4 pl-2 border-l-4 border-yellow-400">ğŸ›ï¸ å¿…è²·æ¸…å–®</h2>
            
            <div class="flex gap-2 mb-4">
                <input id="shopInput" type="text" placeholder="ä¾‹å¦‚: è»Ÿç³–ã€è—¥å¦..." class="flex-1 p-3 sketch-box outline-none">
                <button onclick="addShopItem()" class="bg-yellow-400 px-4 rounded-lg sketch-btn font-bold"><i class="fa-solid fa-plus"></i></button>
            </div>

            <div id="shopList" class="space-y-2"></div>
            <div class="text-center text-xs text-gray-400 mt-4">Tip: é»æ“Šæ–¹å¡Šæ‰“å‹¾ï¼ŒæŒ‰åƒåœ¾æ¡¶åˆªé™¤</div>
        </section>

        <section id="wallet" class="tab-content">
            <h2 class="font-header text-xl mb-4 pl-2 border-l-4 border-green-500">ğŸ’° éŒ¢åŒ…ç®¡å®¶</h2>

            <div class="bg-gray-800 text-white p-4 rounded-xl shadow-lg mb-6 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-gray-700 opacity-20 text-9xl"><i class="fa-solid fa-calculator"></i></div>
                <div class="flex justify-between items-center mb-4 relative z-10">
                    <span class="text-xs font-bold text-gray-400">åŒ¯ç‡è©¦ç®— (åªç®—ä¸è¨˜)</span>
                    <div class="flex bg-gray-700 rounded p-1 gap-1">
                        <button onclick="setCurrency('KR')" id="btn-calc-kr" class="text-xs px-2 py-1 rounded bg-blue-500 text-white">éŸ“å¹£</button>
                        <button onclick="setCurrency('JP')" id="btn-calc-jp" class="text-xs px-2 py-1 rounded text-gray-300">æ—¥å¹£</button>
                    </div>
                </div>
                <div class="flex items-baseline gap-2 relative z-10">
                    <span class="text-2xl font-mono" id="currencySymbol">â‚©</span>
                    <input id="calcInput" type="number" class="bg-transparent text-4xl font-bold w-full outline-none text-white placeholder-gray-600" placeholder="0">
                </div>
                <div class="mt-2 pt-2 border-t border-gray-600 text-right relative z-10">
                    <span class="text-green-400 font-bold text-xl">â‰ˆ NT$ <span id="calcResult">0</span></span>
                </div>
            </div>

            <div class="sketch-box p-4 mb-4">
                <h3 class="font-bold mb-3 text-sm"><i class="fa-solid fa-pen"></i> è¨˜ä¸‹ä¸€ç­†æ¶ˆè²»</h3>
                <div class="flex gap-2 mb-2">
                    <input id="expenseDesc" type="text" placeholder="å“é …" class="flex-1 p-2 border-b-2 border-gray-200 outline-none rounded bg-gray-50">
                    <input id="expenseAmt" type="number" placeholder="å¤–å¹£é‡‘é¡" class="w-24 p-2 border-b-2 border-gray-200 outline-none rounded bg-gray-50">
                </div>
                <button onclick="addExpense()" class="w-full bg-white border-2 border-gray-800 py-2 rounded font-bold hover:bg-gray-100 mt-1">åŠ å…¥å¸³æœ¬</button>
            </div>

            <div id="walletList" class="space-y-3 pb-8"></div>
            <button onclick="clearExpenses()" class="text-xs text-gray-400 underline w-full text-center mb-8">æ¸…ç©ºå¸³æœ¬</button>
        </section>

        <section id="translate" class="tab-content">
            <h2 class="font-header text-xl mb-4 pl-2 border-l-4 border-purple-500">ğŸ—£ï¸ ç¿»è­¯èˆ‡æºé€š</h2>

            <div class="sketch-box p-4 mb-6 bg-purple-50">
                <label class="text-xs font-bold text-gray-500 block mb-2">æˆ‘æƒ³è·Ÿåº—å“¡èªª...</label>
                <div class="flex gap-2">
                    <input id="transInput" type="text" placeholder="è¼¸å…¥ä¸­æ–‡ (ä¾‹å¦‚: è«‹çµ¦æˆ‘æ°´)" class="flex-1 p-2 border border-gray-300 rounded outline-none">
                    <button onclick="quickTranslate()" class="bg-purple-600 text-white px-3 rounded font-bold"><i class="fa-solid fa-language"></i></button>
                </div>
            </div>

            <div class="flex gap-2 mb-4">
                <button onclick="renderPhrases('KR')" id="btn-lang-kr" class="flex-1 py-2 rounded font-bold border-2 border-gray-800 bg-blue-100 text-blue-800">ğŸ‡°ğŸ‡· éŸ“èªåŒ…</button>
                <button onclick="renderPhrases('JP')" id="btn-lang-jp" class="flex-1 py-2 rounded font-bold border-2 border-gray-200 text-gray-400">ğŸ‡¯ğŸ‡µ æ—¥èªåŒ…</button>
            </div>
            <div id="phraseList" class="space-y-3"></div>
        </section>

        <section id="info" class="tab-content">
            <h2 class="font-header text-xl mb-4 pl-2 border-l-4 border-gray-500">â„¹ï¸ å¯¦ç”¨è³‡è¨Š</h2>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="sketch-box p-3 bg-red-50 text-center">
                    <div class="text-xs text-gray-500">æ—¥æœ¬å ±è­¦</div>
                    <div class="text-2xl font-black text-red-600">110</div>
                    <div class="text-xs text-gray-400">æ•‘è­·è»Š 119</div>
                </div>
                <div class="sketch-box p-3 bg-blue-50 text-center">
                    <div class="text-xs text-gray-500">éŸ“åœ‹å ±è­¦</div>
                    <div class="text-2xl font-black text-blue-600">112</div>
                    <div class="text-xs text-gray-400">æ•‘è­·è»Š 119</div>
                </div>
            </div>

            <div class="sketch-box p-4 mb-3">
                <h3 class="font-bold border-b pb-2 mb-2">ğŸš— æ—¥æœ¬è‡ªé§•å¯†èª</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>åŠ æ²¹ (ç´…)</span>
                        <span class="font-bold bg-gray-100 px-2 rounded">Regular Man-tan</span>
                    </div>
                    <div class="flex justify-between">
                        <span>è¨­å®šå°èˆª</span>
                        <span class="font-bold bg-gray-100 px-2 rounded">MapCode Please</span>
                    </div>
                    <div class="flex justify-between">
                        <span>åœè»Šå ´</span>
                        <span class="font-bold bg-gray-100 px-2 rounded">P (Parking)</span>
                    </div>
                </div>
            </div>

            <div class="sketch-box p-4 mb-3">
                <h3 class="font-bold border-b pb-2 mb-2">ğŸ“± éŸ“åœ‹è¨ˆç¨‹è»Š</h3>
                <div class="space-y-2 text-sm">
                    <div class="p-2 bg-gray-100 rounded text-center font-bold text-lg">
                        Jumbo Taxi (å¤§è»Š)
                    </div>
                    <p class="text-xs text-gray-500">è«‹çµ¦å¸æ©Ÿçœ‹éŸ“æ–‡åœ°å€ï¼Œä¸è¦åªå”¸è‹±æ–‡ç«™åã€‚</p>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 flex justify-around items-center py-2 pb-6 z-50 text-[10px]">
        <button onclick="switchTab('plan')" class="nav-btn text-gray-800 w-1/5 flex flex-col items-center p-2">
            <i class="fa-solid fa-map-location-dot text-xl mb-1"></i><b>è¡Œç¨‹</b>
        </button>
        <button onclick="switchTab('shopping')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2">
            <i class="fa-solid fa-cart-shopping text-xl mb-1"></i><b>å¾…è³¼</b>
        </button>
        <button onclick="switchTab('wallet')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2">
            <i class="fa-solid fa-wallet text-xl mb-1"></i><b>éŒ¢åŒ…</b>
        </button>
        <button onclick="switchTab('translate')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2">
            <i class="fa-solid fa-language text-xl mb-1"></i><b>ç¿»è­¯</b>
        </button>
        <button onclick="switchTab('info')" class="nav-btn text-gray-400 w-1/5 flex flex-col items-center p-2">
            <i class="fa-solid fa-circle-info text-xl mb-1"></i><b>è³‡è¨Š</b>
        </button>
    </nav>

    <div id="editModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-6 rounded-xl shadow-2xl border-2 border-gray-800">
            <h3 class="font-header text-xl mb-4" id="modalTitle">ç·¨è¼¯è¡Œç¨‹</h3>
            <input type="hidden" id="editIndex">
            <div class="space-y-3">
                <input id="modalTime" type="time" class="w-full p-2 border rounded bg-gray-50">
                <input id="modalAct" type="text" placeholder="æ¨™é¡Œ/åœ°é»" class="w-full p-2 border rounded">
                <textarea id="modalNote" rows="3" placeholder="å‚™è¨»..." class="w-full p-2 border rounded"></textarea>
            </div>
            <div class="flex gap-2 mt-4">
                <button onclick="closeModal()" class="flex-1 py-2 bg-gray-100 rounded text-gray-500">å–æ¶ˆ</button>
                <button onclick="saveItem()" class="flex-1 py-2 bg-gray-800 text-white rounded font-bold">å„²å­˜</button>
            </div>
            <button onclick="deleteItem()" id="btnDelete" class="w-full mt-2 text-red-500 text-xs py-2 hidden">åˆªé™¤</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™ ---
        const defaultTrip = [
            { d: "D0", date: "2/13", city: "Yunlin", lat: 23.7, lon: 120.4, country: "TW", items: [{ time: "21:30", act: "é›²æ—è™å°¾å‡ºç™¼", note: "é ç´„è¨ˆç¨‹è»Š" }, { time: "22:16", act: "é›²æ—é«˜éµ", note: "æœ«ç­è»Šå‰å¾€æ¡ƒåœ’" }]},
            { d: "D1", date: "2/14", city: "Busan", lat: 35.17, lon: 129.07, country: "KR", items: [{ time: "06:10", act: "é‡‘æµ·æ©Ÿå ´æŠµé”", note: "Money Box æ›éŒ¢" }, { time: "08:00", act: "æ¾äº­ä¸‰ä»£è±¬è‚‰æ¹¯é£¯", note: "è¥¿é¢å¸‚å ´" }]},
            { d: "D2", date: "2/15", city: "Busan", lat: 35.17, lon: 129.07, country: "KR", items: [{ time: "10:30", act: "å¤©ç©ºè† å›Šåˆ—è»Š", note: "å°¾æµ¦å‡ºç™¼" }, { time: "13:00", act: "æµ·ç†åœ˜è·¯", note: "é€›è¡—" }]},
            { d: "D3", date: "2/16", city: "Busan", lat: 35.1, lon: 129.0, country: "KR", items: [{ time: "09:30", act: "ç”˜å·æ´æ–‡åŒ–æ‘", note: "å°ç‹å­æ‹ç…§" }, { time: "17:00", act: "é‡œå±±æ¸¯ç™»èˆ¹", note: "æ–°å±±èŒ¶èŠ±è™Ÿ" }]},
            { d: "D4", date: "2/17", city: "Nagasaki", lat: 32.75, lon: 129.87, country: "JP", items: [{ time: "09:00", act: "åšå¤šè»Šç«™", note: "è²·ç¥¨" }, { time: "11:30", act: "é•·å´ Check-in", note: "ç´¢å–æŠ˜æ‰£å¡" }]},
            { d: "D5", date: "2/18", city: "Nagasaki", lat: 32.75, lon: 129.87, country: "JP", items: [{ time: "10:15", act: "ä¼éµæ°´æ—é¤¨", note: "æ­å·´å£«" }, { time: "17:15", act: "çœ¼é¡æ©‹", note: "æ‰¾æ„›å¿ƒçŸ³" }]},
            { d: "D6", date: "2/19", city: "Hita", lat: 33.32, lon: 130.93, country: "JP", items: [{ time: "08:30", act: "NIPPON å–è»Š", note: "æª¢æŸ¥é›ªèƒ" }, { time: "17:00", act: "å¤©ç€¨æº«æ³‰", note: "æºªä»™é–£" }]},
            { d: "D7", date: "2/20", city: "Yufu", lat: 33.26, lon: 131.36, country: "JP", items: [{ time: "09:40", act: "ä¹å·è‡ªç„¶å‹•ç‰©åœ’", note: "Jungle Bus" }, { time: "15:45", act: "é‡‘é±—æ¹–", note: "æ™¨éœ§" }]},
            { d: "D8", date: "2/21", city: "Oita", lat: 33.23, lon: 131.61, country: "JP", items: [{ time: "12:30", act: "è±å¾ŒèŒ¶å±‹", note: "å¤©å©¦ç¾…" }, { time: "16:30", act: "å¤§åˆ†æ©Ÿå ´", note: "å›å°ç£" }]}
        ];

        const phrases = {
            KR: [{t:"ä½ å¥½",o:"ì•ˆë…•í•˜ì„¸ìš”"}, {t:"è¬è¬",o:"ê°ì‚¬í•©ë‹ˆë‹¤"}, {t:"å¤šå°‘éŒ¢?",o:"ì–¼ë§ˆì˜ˆìš”?"}, {t:"å»æ‰€?",o:"í™”ì¥ì‹¤?"}, {t:"ä¸è¾£",o:"ì•ˆ ë§µê²Œ"}, {t:"è«‹çµ¦æˆ‘é€™å€‹",o:"ì´ê±° ì£¼ì„¸ìš”"}],
            JP: [{t:"ä½ å¥½",o:"ã“ã‚“ã«ã¡ã¯"}, {t:"è¬è¬",o:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™"}, {t:"å¤šå°‘éŒ¢?",o:"ã„ãã‚‰ã§ã™ã‹"}, {t:"å»æ‰€?",o:"ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹"}, {t:"æˆ‘è¦æŠ˜æ‰£å¡",o:"Discount Card ãã ã•ã„"}, {t:"åŠ æ»¿æ²¹",o:"ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³"}]
        };

        let tripData = [];
        let curDay = 0;
        let curRate = 0.024; // Default KR
        let curSymbol = "â‚©";
        let curLang = 'KR';

        function init() {
            const saved = localStorage.getItem('trip_data_2026_v2');
            tripData = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultTrip));
            renderDayNav();
            renderDaily(0);
            renderShopList();
            renderWalletList();
            renderPhrases('KR');
            
            // åŒ¯ç‡ç›£è½
            document.getElementById('calcInput').addEventListener('input', (e) => {
                document.getElementById('calcResult').innerText = Math.round(e.target.value * curRate).toLocaleString();
            });
        }

        // --- 1. è¡Œç¨‹ (Plan) ---
        function renderDayNav() {
            document.getElementById('dayNav').innerHTML = tripData.map((d, i) => `
                <button onclick="renderDaily(${i})" class="flex-shrink-0 px-3 py-2 rounded-lg text-xs font-bold border transition-all ${i === curDay ? 'bg-gray-800 text-white border-gray-800' : 'bg-white text-gray-400 border-gray-200'}">
                    ${d.d} ${d.date}
                </button>
            `).join('');
        }

        function renderDaily(idx) {
            curDay = idx;
            renderDayNav();
            const day = tripData[idx];
            fetchWeather(day.lat, day.lon, day.city);
            
            // è‡ªå‹•åˆ‡æ›åŒ¯ç‡/èªè¨€å»ºè­°
            if(day.country === 'JP' && curLang !== 'JP') { setCurrency('JP'); renderPhrases('JP'); }
            if(day.country === 'KR' && curLang !== 'KR') { setCurrency('KR'); renderPhrases('KR'); }

            document.getElementById('dailyContainer').innerHTML = day.items.map((item, i) => `
                <div class="sketch-box p-4 relative bg-white" onclick="openEditModal(${i})">
                    <div class="flex justify-between items-start mb-1">
                        <span class="bg-yellow-300 text-xs font-black px-2 py-1 rounded border border-black">${item.time}</span>
                        <div class="text-blue-600 font-bold underline cursor-pointer" onclick="event.stopPropagation(); openMap('${item.act}', '${day.country}')">
                            <i class="fa-solid fa-location-arrow"></i> åœ°åœ–
                        </div>
                    </div>
                    <div class="text-lg font-bold mb-1">${item.act}</div>
                    <div class="text-sm text-gray-500 bg-gray-50 p-2 rounded">${item.note}</div>
                </div>
            `).join('');
        }

        function openMap(key, country) {
            const url = country === 'KR' ? `https://map.naver.com/p/search/${key}` : `https://www.google.com/maps/search/?api=1&query=${key}`;
            window.open(url, '_blank');
        }

        // --- 2. å¾…è³¼æ¸…å–® (Shopping) ---
        function addShopItem() {
            const input = document.getElementById('shopInput');
            if(!input.value.trim()) return;
            const list = getStorage('trip_shop_v2');
            list.push({id: Date.now(), txt: input.value, done: false});
            saveStorage('trip_shop_v2', list);
            input.value = '';
            renderShopList();
        }
        function toggleShop(id) {
            const list = getStorage('trip_shop_v2');
            const item = list.find(i => i.id === id);
            if(item) item.done = !item.done;
            saveStorage('trip_shop_v2', list);
            renderShopList();
        }
        function delShop(id) {
            const list = getStorage('trip_shop_v2').filter(i => i.id !== id);
            saveStorage('trip_shop_v2', list);
            renderShopList();
        }
        function renderShopList() {
            const list = getStorage('trip_shop_v2');
            document.getElementById('shopList').innerHTML = list.map(i => `
                <div class="flex items-center bg-white p-3 border-b border-gray-100">
                    <input type="checkbox" class="custom-checkbox mr-3" onchange="toggleShop(${i.id})" ${i.done?'checked':''}>
                    <div class="flex-1 font-bold ${i.done?'checked-item':''}">${i.txt}</div>
                    <button onclick="delShop(${i.id})" class="text-gray-300 hover:text-red-500 px-2"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
        }

        // --- 3. éŒ¢åŒ… (Wallet) ---
        function setCurrency(c) {
            curLang = c;
            curRate = c === 'KR' ? 0.024 : 0.22;
            curSymbol = c === 'KR' ? 'â‚©' : 'Â¥';
            document.getElementById('currencySymbol').innerText = curSymbol;
            document.getElementById('calcInput').value = '';
            document.getElementById('calcResult').innerText = '0';
            
            // Btn Styles
            const bKR = document.getElementById('btn-calc-kr');
            const bJP = document.getElementById('btn-calc-jp');
            if(c==='KR'){ bKR.className="text-xs px-2 py-1 rounded bg-blue-500 text-white"; bJP.className="text-xs px-2 py-1 rounded text-gray-300"; }
            else { bKR.className="text-xs px-2 py-1 rounded text-gray-300"; bJP.className="text-xs px-2 py-1 rounded bg-red-500 text-white"; }
        }
        function addExpense() {
            const d = document.getElementById('expenseDesc').value;
            const a = document.getElementById('expenseAmt').value;
            if(!d || !a) return;
            const list = getStorage('trip_wallet_v2');
            list.unshift({d, a, s: curSymbol, t: Math.round(a*curRate), date: tripData[curDay].date});
            saveStorage('trip_wallet_v2', list);
            document.getElementById('expenseDesc').value='';
            document.getElementById('expenseAmt').value='';
            renderWalletList();
        }
        function renderWalletList() {
            const list = getStorage('trip_wallet_v2');
            document.getElementById('walletList').innerHTML = list.map(i => `
                <div class="flex justify-between items-center bg-white p-3 border-b border-gray-100 last:border-0">
                    <div>
                        <div class="font-bold text-gray-800">${i.d}</div>
                        <div class="text-[10px] text-gray-400">${i.date}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">${i.s}${i.a}</div>
                        <div class="font-bold text-green-600">$${i.t}</div>
                    </div>
                </div>
            `).join('');
        }
        function clearExpenses() { if(confirm('æ¸…ç©º?')) { saveStorage('trip_wallet_v2', []); renderWalletList(); } }

        // --- 4. ç¿»è­¯ (Translate) ---
        function renderPhrases(lang) {
            curLang = lang;
            const list = phrases[lang];
            // Update Btns
            document.getElementById('btn-lang-kr').className = lang==='KR' ? 'flex-1 py-2 rounded font-bold border-2 border-gray-800 bg-blue-100 text-blue-800' : 'flex-1 py-2 rounded font-bold border-2 border-gray-200 text-gray-400';
            document.getElementById('btn-lang-jp').className = lang==='JP' ? 'flex-1 py-2 rounded font-bold border-2 border-gray-800 bg-red-100 text-red-800' : 'flex-1 py-2 rounded font-bold border-2 border-gray-200 text-gray-400';

            document.getElementById('phraseList').innerHTML = list.map(p => `
                <div class="bg-white p-3 rounded border border-gray-200 shadow-sm flex justify-between items-center">
                    <div>
                        <div class="text-xs text-gray-400 font-bold">${p.t}</div>
                        <div class="text-lg font-bold ${lang==='KR'?'text-blue-600':'text-red-600'}">${p.o}</div>
                    </div>
                    <button class="text-gray-300" onclick="quickTranslate('${p.o}')"><i class="fa-solid fa-volume-high"></i></button>
                </div>
            `).join('');
        }
        function quickTranslate(txt) {
            const input = document.getElementById('transInput').value;
            const q = txt || input;
            if(!q) return;
            window.open(`https://translate.google.com/?sl=auto&tl=${curLang==='KR'?'ko':'ja'}&text=${encodeURIComponent(q)}&op=translate`, '_blank');
        }

        // --- Shared & Helpers ---
        function getStorage(k) { return JSON.parse(localStorage.getItem(k)||'[]'); }
        function saveStorage(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
        
        async function fetchWeather(lat, lon, city) {
            const elC = document.getElementById('w-city');
            const elT = document.getElementById('w-temp');
            const elD = document.getElementById('w-desc');
            const board = document.getElementById('weatherBoard');
            board.classList.remove('hidden');
            elC.innerText = city; elD.innerText = 'æ›´æ–°ä¸­...';
            try {
                const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const d = await r.json();
                elT.innerText = Math.round(d.current_weather.temperature);
                elD.innerText = 'å³æ™‚æ°£æº«';
            } catch(e){ elD.innerText = 'é›¢ç·š'; }
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('text-gray-800'); b.classList.add('text-gray-400'); });
            event.currentTarget.classList.remove('text-gray-400'); event.currentTarget.classList.add('text-gray-800');
            window.scrollTo(0,0);
        }

        // Edit Modal
        function openEditModal(i=-1) {
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editIndex').value = i;
            if(i===-1) {
                document.getElementById('modalTitle').innerText="æ–°å¢"; document.getElementById('btnDelete').classList.add('hidden');
                document.getElementById('modalTime').value="09:00"; document.getElementById('modalAct').value=""; document.getElementById('modalNote').value="";
            } else {
                const item = tripData[curDay].items[i];
                document.getElementById('modalTitle').innerText="ç·¨è¼¯"; document.getElementById('btnDelete').classList.remove('hidden');
                document.getElementById('modalTime').value=item.time; document.getElementById('modalAct').value=item.act; document.getElementById('modalNote').value=item.note;
            }
        }
        function closeModal() { document.getElementById('editModal').classList.add('hidden'); }
        function saveItem() {
            const idx = parseInt(document.getElementById('editIndex').value);
            const item = { time: document.getElementById('modalTime').value, act: document.getElementById('modalAct').value, note: document.getElementById('modalNote').value };
            if(!item.act) return;
            if(idx===-1) tripData[curDay].items.push(item); else tripData[curDay].items[idx]=item;
            tripData[curDay].items.sort((a,b)=>a.time.localeCompare(b.time));
            localStorage.setItem('trip_data_2026_v2', JSON.stringify(tripData));
            renderDaily(curDay); closeModal();
        }
        function deleteItem() {
            const idx = parseInt(document.getElementById('editIndex').value);
            if(confirm('åˆªé™¤?')) { tripData[curDay].items.splice(idx,1); localStorage.setItem('trip_data_2026_v2', JSON.stringify(tripData)); renderDaily(curDay); closeModal(); }
        }
        function resetData() { if(confirm('é‡ç½®æ‰€æœ‰è³‡æ–™?')) { localStorage.clear(); location.reload(); } }

        init();
    </script>
</body>
</html>
