<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 è·¨åœ‹å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-paper: #fffdf5; --ink: #2c2c2c; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-paper); color: var(--ink); -webkit-tap-highlight-color: transparent; padding-bottom: 110px; }
        .font-header { font-family: 'ZCOOL KuaiLe', cursive; }
        .sketch-box { background: white; border: 2px solid var(--ink); border-radius: 8px; box-shadow: 2px 2px 0px rgba(0,0,0,0.1); }
        .custom-checkbox { width: 1rem; height: 1rem; accent-color: var(--ink); }
        .checked-item { text-decoration: line-through; color: #9ca3af; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-overlay { background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 60; }
        .booking-tag { position: absolute; top: -10px; left: 10px; background: var(--ink); color: white; padding: 2px 8px; font-size: 10px; border-radius: 4px; font-weight: bold; }
        
        @media print {
            body { background: white; padding: 0; }
            header, nav, .tab-content, #weatherBoard, button, .modal-overlay { display: none !important; }
            #print-area { display: block !important; padding: 20px; }
            .print-page { page-break-after: always; }
            .print-section { margin-bottom: 20px; border: 2px solid #333; border-radius: 10px; padding: 15px; }
            .print-h1 { font-family: 'ZCOOL KuaiLe'; font-size: 24px; text-align: center; margin-bottom: 10px; border-bottom: 2px solid #333; padding-bottom: 10px; }
            .print-h2 { font-size: 18px; font-weight: bold; margin-top: 15px; margin-bottom: 5px; color: #333; border-left: 5px solid #333; padding-left: 10px; background: #eee; }
            .print-item { margin-bottom: 8px; font-size: 14px; }
            .print-time { font-weight: bold; display: inline-block; width: 60px; background: #ddd; text-align: center; border-radius: 4px; margin-right: 5px; }
            .print-note { font-size: 12px; color: #555; margin-left: 65px; margin-top: 2px; white-space: pre-wrap; }
        }
        #print-area { display: none; }
    </style>
</head>
<body>

    <header class="bg-white border-b-2 border-gray-800 pt-12 pb-3 px-4 sticky top-0 z-40 flex justify-between items-center shadow-sm">
        <div>
            <h1 class="text-xl font-header tracking-wider">ğŸ¦• è·¨åœ‹å†’éšª 2026</h1>
            <div class="text-[10px] text-gray-400 font-bold uppercase">YUNLIN â” BUSAN â” KYUSHU</div>
        </div>
        <button onclick="resetData()" class="text-[10px] text-gray-300 border px-2 py-1 rounded">é‡ç½®</button>
    </header>

    <main class="p-4 max-w-lg mx-auto">
        
        <section id="plan" class="tab-content active">
            <div class="flex overflow-x-auto gap-2 pb-2 mb-2 no-scrollbar" id="dayNav"></div>
            <div id="weatherBoard" class="mb-3 bg-blue-50 p-2 rounded border border-blue-100 flex justify-between items-center hidden">
                <div class="flex items-center gap-2"><div id="w-icon" class="text-xl">â›…</div><div class="flex items-baseline gap-1"><span id="w-city" class="text-[10px] font-bold text-gray-400 uppercase">LOC</span><span id="w-temp" class="text-lg font-black text-gray-800">--</span><span class="text-xs">Â°C</span></div></div><div id="w-desc" class="text-[10px] font-bold text-blue-600 bg-white px-2 py-0.5 rounded">æ›´æ–°ä¸­</div>
            </div>
            <div id="dailyContainer" class="space-y-3"></div>
            <button onclick="openEditModal('trip')" class="w-full mt-4 mb-6 py-3 border-2 border-dashed border-gray-300 text-gray-400 rounded-xl text-sm font-bold hover:border-gray-800 hover:text-gray-800"><i class="fa-solid fa-plus"></i> æ–°å¢è¡Œç¨‹</button>
            
            <div class="sketch-box p-4 bg-gray-50 mt-6 relative">
                <div class="absolute -top-3 left-3 bg-green-600 text-white text-[10px] px-2 py-0.5 rounded font-bold border border-black shadow-sm">ğŸ“… ä»Šæ—¥æ¶ˆè²»</div>
                <div class="flex justify-between items-end mb-3 mt-1 px-1"><div class="text-xs text-gray-400 font-bold">ç•¶æ—¥ç¸½è¨ˆ</div><div class="text-xl font-black text-green-700" id="dailyTotalDisplay">NT$ 0</div></div>
                <div class="flex items-center bg-white border-2 border-gray-200 rounded-full overflow-hidden shadow-sm h-12">
                    <input id="quickExpDesc" type="text" placeholder="å“é …" class="flex-1 p-3 pl-4 text-sm outline-none bg-transparent min-w-0 h-full">
                    <select id="quickExpCurr" class="h-full px-2 text-xs font-bold outline-none bg-transparent text-gray-500 cursor-pointer border-l border-r border-gray-100"><option value="KR">â‚©</option><option value="JP">Â¥</option></select>
                    <input id="quickExpAmt" type="number" placeholder="é‡‘é¡" class="w-20 p-3 text-sm outline-none bg-transparent text-center h-full">
                    <button onclick="addExpenseFromPlan()" class="bg-gray-800 text-white h-full px-5 hover:bg-black transition-colors border-l border-gray-800"><i class="fa-solid fa-check"></i></button>
                </div>
                <div id="dailyExpenseList" class="space-y-2 text-sm text-gray-600 px-2 mt-3"></div>
            </div>
        </section>

        <section id="shopping" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-yellow-400">ğŸ›ï¸ å¿…è²·æ¸…å–®</h2>
            <div class="mb-6"><div class="flex gap-2 mb-2"><input id="shopInput" type="text" placeholder="æ–‡å­—é …ç›®..." class="flex-1 p-2 sketch-box outline-none text-sm"><button onclick="addShopItem()" class="bg-yellow-400 px-3 rounded border-2 border-gray-800 shadow-sm font-bold text-sm"><i class="fa-solid fa-pen"></i></button></div><div id="shopList" class="space-y-1 max-h-40 overflow-y-auto"></div></div>
            <hr class="border-dashed border-gray-300 mb-4">
            <div><div class="flex justify-between items-center mb-2"><h3 class="font-bold text-sm text-gray-500"><i class="fa-regular fa-image"></i> ç…§ç‰‡å‚™è¨»ç‰†</h3><label class="bg-gray-800 text-white px-3 py-1 rounded text-xs cursor-pointer shadow active:scale-95"><i class="fa-solid fa-camera"></i> æ–°å¢<input type="file" id="imgInput" accept="image/*" class="hidden" onchange="handleAddImage('shop')"></label></div><div id="imageGrid" class="space-y-3"></div></div>
        </section>

        <section id="traffic" class="tab-content">
            <h2 class="font-header text-lg mb-4 pl-2 border-l-4 border-blue-400">âœˆï¸ äº¤é€šè³‡è¨Š</h2>
            <div id="trafficList" class="space-y-4 mt-2"></div>
            <button onclick="openBookingModal('traffic', -1)" class="w-full mt-4 py-2 border border-gray-300 text-gray-400 rounded text-sm hover:bg-gray-50"><i class="fa-solid fa-plus"></i> æ–°å¢äº¤é€š</button>
        </section>

        <section id="stay" class="tab-content">
            <h2 class="font-header text-lg mb-4 pl-2 border-l-4 border-indigo-400">ğŸ¨ ä½å®¿è³‡è¨Š</h2>
            <div id="stayList" class="space-y-4 mt-2"></div>
            <button onclick="openBookingModal('stay', -1)" class="w-full mt-4 py-2 border border-gray-300 text-gray-400 rounded text-sm hover:bg-gray-50"><i class="fa-solid fa-plus"></i> æ–°å¢ä½å®¿</button>
        </section>

        <section id="diary" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-pink-400">ğŸ“” æ—…éŠæ—¥è¨˜</h2>
            <div class="sketch-box p-3 mb-4 bg-pink-50"><textarea id="diaryInput" rows="3" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼æœ‰è¶£çš„äº‹..." class="w-full p-2 outline-none text-sm resize-none bg-transparent"></textarea><div id="diaryImgPreview" class="hidden mt-2 relative w-16 h-16"><img id="dPreview" class="w-full h-full object-cover rounded"><button onclick="clearDiaryImg()" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 text-[10px] flex items-center justify-center">âœ•</button></div><div class="flex justify-between items-center mt-2 pt-2 border-t border-pink-100"><label class="text-pink-400 cursor-pointer p-1"><i class="fa-solid fa-camera"></i><input type="file" id="diaryImgInput" accept="image/*" class="hidden" onchange="handleDiaryImg()"></label><button onclick="addDiary()" class="bg-pink-500 text-white px-4 py-1 rounded text-sm font-bold shadow-sm">ä¿å­˜</button></div></div>
            <div id="diaryList" class="space-y-3"></div>
        </section>

        <section id="todo" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-orange-400">âœ… å¾…è¾¦äº‹é …</h2>
            <div class="flex gap-2 mb-4"><input id="todoInput" type="text" placeholder="ä¾‹å¦‚: é ˜ç¶²å¡..." class="flex-1 p-2 sketch-box outline-none text-sm"><button onclick="addTodo()" class="bg-orange-400 px-3 rounded border-2 border-gray-800 shadow-sm font-bold text-sm"><i class="fa-solid fa-plus"></i></button></div>
            <div id="todoList" class="space-y-2"></div>
        </section>

        <section id="wallet" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-green-500">ğŸ’° åŒ¯ç‡è¨ˆç®—</h2>
            <div class="bg-gray-800 text-white p-5 rounded-xl shadow-lg mb-6 relative"><div class="flex justify-between items-center mb-6"><span class="text-xs font-bold text-gray-400">è³¼ç‰©è©¦ç®—</span><div class="flex bg-gray-700 rounded p-1 gap-1"><button onclick="setCurrency('KR')" id="btn-calc-kr" class="text-xs px-3 py-1 rounded bg-blue-500 text-white transition-all">éŸ“å¹£</button><button onclick="setCurrency('JP')" id="btn-calc-jp" class="text-xs px-3 py-1 rounded text-gray-300 transition-all">æ—¥å¹£</button></div></div><div class="flex items-baseline gap-2"><span class="text-2xl font-mono text-gray-400" id="currencySymbol">â‚©</span><input id="calcInput" type="number" class="bg-transparent text-5xl font-bold w-full outline-none text-white placeholder-gray-600" placeholder="0"></div><div class="mt-4 pt-3 border-t border-gray-600 text-right"><div class="text-xs text-gray-400 mb-1">ç´„å°å¹£</div><div class="text-green-400 font-bold text-3xl">NT$ <span id="calcResult">0</span></div></div></div>
        </section>

        <section id="translate" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-purple-500">ğŸ—£ï¸ ç¿»è­¯è¼”åŠ©</h2>
            <div class="relative mb-4"><input id="transInput" type="text" placeholder="è¼¸å…¥ä¸­æ–‡..." class="w-full p-3 pr-16 sketch-box outline-none text-sm bg-purple-50"><button onclick="quickTranslate()" class="absolute right-1.5 top-1.5 bottom-1.5 bg-purple-600 text-white px-3 rounded font-bold text-xs shadow">GO</button></div>
            <div class="flex gap-2 mb-3"><button onclick="renderPhrases('KR')" id="btn-lang-kr" class="flex-1 py-1.5 rounded text-sm font-bold border bg-blue-100 text-blue-800">ğŸ‡°ğŸ‡· éŸ“èª</button><button onclick="renderPhrases('JP')" id="btn-lang-jp" class="flex-1 py-1.5 rounded text-sm font-bold border bg-white text-gray-400">ğŸ‡¯ğŸ‡µ æ—¥èª</button></div>
            <div id="phraseList" class="space-y-2"></div>
        </section>

        <section id="info" class="tab-content">
            <h2 class="font-header text-lg mb-3 pl-2 border-l-4 border-gray-500">â„¹ï¸ å¯¦ç”¨ç­†è¨˜</h2>
            <div id="infoList" class="space-y-3"></div>
            <button onclick="openDedicatedInfoModal()" class="w-full mt-4 py-3 border-2 border-dashed border-gray-300 text-gray-400 rounded-lg text-sm hover:border-gray-500 font-bold"><i class="fa-solid fa-plus"></i> æ–°å¢ç­†è¨˜</button>

            <div class="mt-8 pt-6 border-t-2 border-gray-100">
                <h3 class="font-bold text-gray-400 text-xs mb-3 uppercase tracking-wider">ğŸ“± åŒæ­¥èˆ‡æ‰‹å†Š</h3>
                <button onclick="printBrochure()" class="w-full bg-gray-800 text-white p-3 rounded-lg text-sm font-bold shadow mb-3 flex items-center justify-center gap-2"><i class="fa-solid fa-print"></i> è£½ä½œæ‰‹å†Š (PDF)</button>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="copySyncCode()" class="bg-blue-50 text-blue-700 p-2 rounded-lg text-[10px] font-bold border border-blue-200">è¤‡è£½åŒæ­¥ç¢¼</button>
                    <button onclick="pasteSyncCode()" class="bg-green-50 text-green-700 p-2 rounded-lg text-[10px] font-bold border border-green-200">è²¼ä¸ŠåŒæ­¥ç¢¼</button>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 py-3 pb-6 z-50">
        <div class="flex overflow-x-auto no-scrollbar px-4 gap-4 items-center">
            <button onclick="switchTab('plan')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-800"><i class="fa-solid fa-map-location-dot text-xl mb-1"></i><b class="text-[10px]">è¡Œç¨‹</b></button>
            <button onclick="switchTab('shopping')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-cart-shopping text-xl mb-1"></i><b class="text-[10px]">å¾…è³¼</b></button>
            <button onclick="switchTab('traffic')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-plane text-xl mb-1"></i><b class="text-[10px]">äº¤é€š</b></button>
            <button onclick="switchTab('stay')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-hotel text-xl mb-1"></i><b class="text-[10px]">ä½å®¿</b></button>
            <button onclick="switchTab('diary')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-book text-xl mb-1"></i><b class="text-[10px]">æ—¥è¨˜</b></button>
            <button onclick="switchTab('todo')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-check-square text-xl mb-1"></i><b class="text-[10px]">å¾…è¾¦</b></button>
            <button onclick="switchTab('wallet')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-calculator text-xl mb-1"></i><b class="text-[10px]">éŒ¢åŒ…</b></button>
            <button onclick="switchTab('translate')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-language text-xl mb-1"></i><b class="text-[10px]">ç¿»è­¯</b></button>
            <button onclick="switchTab('info')" class="nav-btn flex-shrink-0 flex flex-col items-center w-12 text-gray-400"><i class="fa-solid fa-circle-info text-xl mb-1"></i><b class="text-[10px]">è³‡è¨Š</b></button>
        </div>
    </nav>

    <div id="editModal" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-5 rounded-lg shadow-2xl border-2 border-gray-800">
            <h3 class="font-header text-lg mb-3" id="modalTitle">ç·¨è¼¯è¡Œç¨‹</h3>
            <input type="hidden" id="editIndex">
            <div class="space-y-3">
                <input id="modalTime" type="time" class="w-full p-2 border rounded bg-gray-50">
                <input id="modalAct" type="text" placeholder="æ¨™é¡Œ" class="w-full p-2 border rounded">
                <textarea id="modalNote" rows="3" placeholder="å‚™è¨»..." class="w-full p-2 border rounded"></textarea>
            </div>
            <div class="flex gap-2 mt-4"><button onclick="closeModal('editModal')" class="flex-1 py-2 bg-gray-100 rounded text-gray-500 text-sm">å–æ¶ˆ</button><button onclick="saveItem()" class="flex-1 py-2 bg-gray-800 text-white rounded font-bold text-sm">å„²å­˜</button></div>
            <button onclick="deleteItem()" id="btnDelete" class="w-full mt-2 text-red-500 text-xs py-2 hidden">åˆªé™¤</button>
        </div>
    </div>

    <div id="bookingModal" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-5 rounded-lg shadow-2xl border-2 border-gray-800">
            <h3 class="font-header text-lg mb-3" id="bookingTitle">ç·¨è¼¯è³‡è¨Š</h3>
            <input type="hidden" id="bkType"><input type="hidden" id="bkId">
            <div class="space-y-3">
                <input id="bkTitle" type="text" placeholder="æ¨™é¡Œ" class="w-full p-2 border rounded font-bold">
                <input id="bkSub" type="text" placeholder="å‰¯æ¨™é¡Œ" class="w-full p-2 border rounded">
                <textarea id="bkNote" rows="6" placeholder="å‚™è¨»..." class="w-full p-2 border rounded"></textarea>
            </div>
            <div class="flex gap-2 mt-4"><button onclick="closeModal('bookingModal')" class="flex-1 py-2 bg-gray-100 rounded text-gray-500 text-sm">å–æ¶ˆ</button><button onclick="saveBooking()" class="flex-1 py-2 bg-gray-800 text-white rounded font-bold text-sm">å„²å­˜</button></div>
            <button onclick="deleteBooking()" id="bkDelete" class="w-full mt-2 text-red-500 text-xs py-2 hidden">åˆªé™¤</button>
        </div>
    </div>

    <div id="infoModal" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm p-5 rounded-lg shadow-2xl border-2 border-gray-800">
            <h3 class="font-header text-lg mb-3">ç­†è¨˜</h3>
            <input type="hidden" id="infoIndex">
            <div class="space-y-3"><input id="infoTitleInput" type="text" placeholder="æ¨™é¡Œ" class="w-full p-2 border rounded font-bold"><textarea id="infoContentInput" rows="6" placeholder="å…§å®¹..." class="w-full p-2 border rounded"></textarea></div>
            <div class="flex gap-2 mt-4"><button onclick="closeModal('infoModal')" class="flex-1 py-2 bg-gray-100 rounded text-gray-500 text-sm">å–æ¶ˆ</button><button onclick="saveInfo()" class="flex-1 py-2 bg-gray-800 text-white rounded font-bold text-sm">å„²å­˜</button></div>
            <button onclick="deleteInfoModal()" id="infoDelete" class="w-full mt-2 text-red-500 text-xs py-2 hidden">åˆªé™¤</button>
        </div>
    </div>

    <div id="imgModal" class="fixed inset-0 modal-overlay hidden z-[70] flex items-center justify-center p-2" onclick="closeImgModal()"><img id="zoomImg" class="max-w-full max-h-[90vh] rounded shadow-2xl"></div>
    <div id="print-area"></div>

    <script>
        // --- å…§å»ºè³‡æ–™ (åŒ…å«æ‚¨æœ€æ–°çš„ä½å®¿æ¸…å–®) ---
        const defaultTrip = [{ d: "D0", date: "2/13", city: "Yunlin", lat: 23.7, lon: 120.4, items: [{ time: "21:30", act: "é›²æ—è™å°¾å‡ºç™¼", note: "é ç´„è¨ˆç¨‹è»Š" }]},{ d: "D1", date: "2/14", city: "Busan", lat: 35.17, lon: 129.07, items: [{ time: "06:10", act: "é‡‘æµ·æ©Ÿå ´", note: "æ›éŒ¢/Q-CODE" }]},{ d: "D2", date: "2/15", city: "Busan", lat: 35.17, lon: 129.07, items: [{ time: "10:30", act: "å¤©ç©ºè† å›Šåˆ—è»Š", note: "å°¾æµ¦å‡ºç™¼" }]},{ d: "D3", date: "2/16", city: "Busan", lat: 35.1, lon: 129.0, items: [{ time: "09:30", act: "ç”˜å·æ´æ–‡åŒ–æ‘", note: "å°ç‹å­" }]},{ d: "D4", date: "2/17", city: "Nagasaki", lat: 32.75, lon: 129.87, items: [{ time: "09:00", act: "åšå¤šè»Šç«™", note: "è²·ç¥¨" }]},{ d: "D5", date: "2/18", city: "Nagasaki", lat: 32.75, lon: 129.87, items: [{ time: "10:15", act: "ä¼éµæ°´æ—é¤¨", note: "æ­å·´å£«" }]},{ d: "D6", date: "2/19", city: "Hita", lat: 33.32, lon: 130.93, items: [{ time: "08:30", act: "NIPPON å–è»Š", note: "æª¢æŸ¥é›ªèƒ" }]},{ d: "D7", date: "2/20", city: "Yufu", lat: 33.26, lon: 131.36, items: [{ time: "09:40", act: "ä¹å·è‡ªç„¶å‹•ç‰©åœ’", note: "Jungle Bus" }]},{ d: "D8", date: "2/21", city: "Oita", lat: 33.23, lon: 131.61, items: [{ time: "12:30", act: "è±å¾ŒèŒ¶å±‹", note: "å¤©å©¦ç¾…" }]];
        const defaultInfo = [{"title":"æ—¥æœ¬å ±è­¦","text":"110 (æ•‘è­· 119)","id":1768977333327},{"title":"éŸ“åœ‹å ±è­¦","text":"112 (æ•‘è­· 119)","id":1768977333328}];
        const defaultTraffic = [{id:1, title:"æ¿Ÿå·èˆªç©º 7C6164", sub:"TPE â” PUS", note:"ä»£è™Ÿ: D4ZK4L"},{id:2, title:"å°ç£è™èˆª IT751", sub:"OIT â” TPE", note:"ä»£è™Ÿ: V82MGZ"}];
        // æ‚¨æä¾›çš„ä½å®¿è³‡æ–™
        const defaultStay = [
            {"id":1,"title":"[D1-D2]é‡œå±±è¥¿é¢é£¯åº—Queens Hotel Seomyeon","sub":"åœ°å€ï¼š 56 Bujeon-ro, Busanjin District, Busan, å—éŸ“","note":"AGODAè¨‚å–®ç·¨è™Ÿ1668320903\né›»è©±:+82518068871\nStandard Double Room - Walking Special*2"},
            {"id":2,"title":"[D4-D5]JRä¹å·é£¯åº—é•·å´JR Kyushu Hotel Nagasaki","sub":"åœ°å€ï¼š 1-1 Onouemachi, Nagasaki, 850-0058æ—¥æœ¬","note":"AGODAè¨‚å–®ç·¨è™Ÿ:1974169786\né›»è©±è™Ÿç¢¼ï¼š +81 95-832-8000\n2026å¹´2æœˆ17(äºŒ) - 2026å¹´2æœˆ19æ—¥(å››)Double Room - Non-Smoking*2\n(è¨˜å¾—ç´¢å–æŠ˜æ‰£å¡)"},
            {"id":3,"title":"[D6]å¤©ç€¨æº«æ³‰ æºªä»™é–£","sub":"åœ°å€:879-4202 æ—¥ç”°å¸‚å¤©ç€¨ç”ºèµ¤å²©913-1","note":"2026/02/19 (å››)17:00å«æ—©é¤ ï¼ˆåœ¨å®¢æˆ¿å†…ç”¨é¤ï¼‰, å«æ™šé¤ ï¼ˆåœ¨å®¢æˆ¿å†…ç”¨é¤ï¼‰\né è¨‚è™Ÿç¢¼:6LA4VQJ2\nç¢ºèªè™Ÿç¢¼:4755110378\né›»è©±: +81-973-57-2355\n"},
            {"id":1768977504334,"title":"[D7]JRä¹å·é£¯åº— Blossom å¤§åˆ†","sub":"åœ°å€ï¼š 1-14 Kanamemachi, Oita, 870-0831æ—¥æœ¬","note":"2026/02/20(äº”)ã€œ2026/02/21(å…­)è±ªè¯é›™äººæˆ¿ï¼ˆä¸‰äººæˆ¿ï¼‰(å«æ—©é¤)\næœƒå“¡ç·¨è™Ÿï¼šWEB1004419\né è¨‚ç·¨è™Ÿï¼š3251-0282-3462\né›»è©±è™Ÿç¢¼ï¼š +81 97-578-8719\nhttps://www.jrhotel-m.jp/special/lang/zh-tw/\n\nå¤§æ¦‚æŠµé”æ™‚é–“æˆ‘å¡«20:00"},
            {"id":1768977688341,"title":"[D3]æ–°å±±èŒ¶èŠ±è™Ÿéƒµè¼ª","sub":"åœ°å€:206 Chungjang-daero, Dong-gu, Busan, å—éŸ“","note":"16:30åˆ°18:30æº–å‚™ç™»èˆ¹\n20:00å‡ºç™¼éš”å¤©07:30åˆ°é”\n2026/02/16é‡œå±±åˆ°ç¦å²¡\näºŒç­‰å®¤é€šé‹ªå¤§äºº*1ç‰¹ç­‰æˆ¿1å¤§2å°*1\nâ€»æ—…å®¢åå–®å·²é€²å…¥å±±èŒ¶èŠ±è™Ÿç³»çµ±ä¸­ï¼Œä¹˜èˆ¹ç•¶æ—¥è«‹æ†‘ã€Œè­·ç…§ã€æ–¼å±±èŒ¶èŠ±è™Ÿæ«ƒè‡ºè¾¦ç†ç™»èˆ¹æ‰‹çºŒä¸¦é ˜å–èˆ¹ç¥¨ã€‚\nâ€»æ­ä¹˜å±±èŒ¶èŠ±è™Ÿå…¥å¢ƒæ—¥æœ¬ä¸éœ€ç™»éŒ„Visit Japan Webï¼Œè«‹æŒè­·ç…§åŠæµ·é—œå–®é€šéæµ·é—œã€‚"}
        ];

        let tripData = [], infoData = [], bookings = {traffic:[], stay:[]}, diary=[], todos=[];
        let curDay = 0, curLang = 'KR', curRate = 0.024;

        function init() {
            tripData = getStorage('trip_data_v18', defaultTrip);
            infoData = getStorage('trip_info_v18', defaultInfo);
            bookings.traffic = getStorage('trip_traffic_v18', defaultTraffic);
            bookings.stay = getStorage('trip_stay_v18', defaultStay);
            diary = getStorage('trip_diary_v18', []);
            todos = getStorage('trip_todo_v18', [{id:1, txt:"è¾¦ç†è­·ç…§", done:false}]);
            renderDayNav(); renderDaily(0); renderShopList(); renderShopImages(); renderInfoList(); renderBookings('traffic'); renderBookings('stay'); renderDiary(); renderTodo();
        }

        // --- åŒæ­¥æ©Ÿåˆ¶ ---
        function copySyncCode() {
            const all = { trip: tripData, info: infoData, traffic: bookings.traffic, stay: bookings.stay, diary: diary, todos: todos, shop: getStorage('trip_shop_v18', []), wallet: getStorage('trip_wallet_v18', []) };
            const code = btoa(unescape(encodeURIComponent(JSON.stringify(all))));
            navigator.clipboard.writeText(code).then(() => alert("ä»£ç¢¼å·²è¤‡è£½ï¼è«‹å‚³é€åˆ°æ‰‹æ©Ÿè²¼ä¸Šã€‚"));
        }
        function pasteSyncCode() {
            const code = prompt("è«‹è²¼ä¸ŠåŒæ­¥ä»£ç¢¼ï¼š");
            if(!code) return;
            try {
                const data = JSON.parse(decodeURIComponent(escape(atob(code))));
                saveStorage('trip_data_v18', data.trip); saveStorage('trip_info_v18', data.info);
                saveStorage('trip_traffic_v18', data.traffic); saveStorage('trip_stay_v18', data.stay);
                saveStorage('trip_diary_v18', data.diary); saveStorage('trip_todo_v18', data.todos);
                saveStorage('trip_shop_v18', data.shop); saveStorage('trip_wallet_v18', data.wallet);
                alert("åŒæ­¥æˆåŠŸï¼"); location.reload();
            } catch(e) { alert("ä»£ç¢¼ç„¡æ•ˆã€‚"); }
        }

        function linkify(text) { if (!text) return ''; return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-600 underline font-bold">$1</a>'); }
        function renderDayNav() { document.getElementById('dayNav').innerHTML = tripData.map((d, i) => `<button onclick="renderDaily(${i})" class="flex-shrink-0 px-3 py-1.5 rounded text-xs font-bold border ${i === curDay ? 'bg-gray-800 text-white' : 'bg-white text-gray-400'}">${d.d} ${d.date}</button>`).join(''); }
        function renderDaily(idx) { curDay = idx; renderDayNav(); document.getElementById('dailyContainer').innerHTML = tripData[idx].items.map((item, i) => `<div class="sketch-box p-3 bg-white" onclick="openEditModal('trip', ${i})"><div class="text-[10px] font-bold bg-yellow-300 px-1 inline-block border border-black mb-1">${item.time}</div><div class="font-bold text-blue-800">${item.act}</div><div class="text-xs text-gray-500 whitespace-pre-wrap">${item.note}</div></div>`).join(''); renderDailyExpenses(); }
        function renderDailyExpenses() { const list = getStorage('trip_wallet_v18', []).filter(i => i.date === tripData[curDay].date); const total = list.reduce((sum, item) => sum + Math.round(item.a * RATES[item.c]), 0); document.getElementById('dailyTotalDisplay').innerText = `NT$ ${total.toLocaleString()}`; document.getElementById('dailyExpenseList').innerHTML = list.map(item => `<div class="flex justify-between border-b py-1"><span>${item.d}</span><span>${item.c==='KR'?'â‚©':'Â¥'}${item.a}</span></div>`).join(''); }
        function addExpenseFromPlan() { const desc = document.getElementById('quickExpDesc').value, amt = document.getElementById('quickExpAmt').value, curr = document.getElementById('quickExpCurr').value; if(!desc || !amt) return; const list = getStorage('trip_wallet_v18', []); list.push({ d: desc, a: amt, c: curr, date: tripData[curDay].date }); saveStorage('trip_wallet_v18', list); document.getElementById('quickExpDesc').value = ''; document.getElementById('quickExpAmt').value = ''; renderDailyExpenses(); }
        function renderBookings(type) { document.getElementById(type+'List').innerHTML = bookings[type].map((b) => `<div class="sketch-box p-4 bg-white relative mt-3"><div class="booking-tag">${type==='traffic'?'äº¤é€š':'ä½å®¿'}</div><button onclick="openBookingModal('${type}', ${b.id})" class="absolute top-2 right-2 text-gray-400 p-2"><i class="fa-solid fa-pen"></i></button><div class="font-bold text-lg mt-2">${b.title}</div><div class="text-xs font-bold text-gray-400 mb-2">${b.sub}</div><div class="text-[13px] bg-gray-50 p-3 rounded whitespace-pre-wrap leading-relaxed">${linkify(b.note)}</div></div>`).join(''); }
        function renderInfoList() { document.getElementById('infoList').innerHTML = infoData.map((item, idx) => `<div class="sketch-box p-3 bg-white flex justify-between items-center" onclick="openDedicatedInfoModal(${idx})"><div><div class="text-xs text-gray-500">${item.title}</div><div class="text-lg font-black whitespace-pre-wrap">${item.text}</div></div><button onclick="event.stopPropagation(); deleteInfoItem(${idx})" class="text-gray-300"><i class="fa-solid fa-trash"></i></button></div>`).join(''); }
        function openDedicatedInfoModal(idx = -1) { document.getElementById('infoModal').classList.remove('hidden'); document.getElementById('infoIndex').value = idx; if(idx !== -1) { document.getElementById('infoTitleInput').value = infoData[idx].title; document.getElementById('infoContentInput').value = infoData[idx].text; } else { document.getElementById('infoTitleInput').value = ""; document.getElementById('infoContentInput').value = ""; } }
        function saveInfo() { const idx = parseInt(document.getElementById('infoIndex').value); const title = document.getElementById('infoTitleInput').value, text = document.getElementById('infoContentInput').value; if(!title) return; if(idx === -1) infoData.push({ id: Date.now(), title, text }); else { infoData[idx].title = title; infoData[idx].text = text; } saveStorage('trip_info_v18', infoData); renderInfoList(); closeModal('infoModal'); }
        function deleteInfoItem(idx) { if(confirm('åˆªé™¤?')) { infoData.splice(idx, 1); saveStorage('trip_info_v18', infoData); renderInfoList(); } }
        function openBookingModal(type, id) { document.getElementById('bookingModal').classList.remove('hidden'); document.getElementById('bkType').value = type; document.getElementById('bkId').value = id; if(id !== -1) { const item = bookings[type].find(b => b.id === id); if(item) { document.getElementById('bkTitle').value = item.title; document.getElementById('bkSub').value = item.sub; document.getElementById('bkNote').value = item.note; } } else { document.getElementById('bkTitle').value = ""; document.getElementById('bkSub').value = ""; document.getElementById('bkNote').value = ""; } }
        function saveBooking() { const type = document.getElementById('bkType').value, id = parseInt(document.getElementById('bkId').value), title = document.getElementById('bkTitle').value, sub = document.getElementById('bkSub').value, note = document.getElementById('bkNote').value; if(!title) return; if(id === -1) bookings[type].push({id: Date.now(), title, sub, note}); else { const b = bookings[type].find(b => b.id === id); if(b) { b.title = title; b.sub = sub; b.note = note; } } saveStorage('trip_'+type+'_v18', bookings[type]); renderBookings(type); closeModal('bookingModal'); }
        function deleteBooking() { const type = document.getElementById('bkType').value, id = parseInt(document.getElementById('bkId').value); if(confirm('åˆªé™¤?')) { bookings[type] = bookings[type].filter(b => b.id !== id); saveStorage('trip_'+type+'_v18', bookings[type]); renderBookings(type); closeModal('bookingModal'); } }

        function getStorage(k, d) { return JSON.parse(localStorage.getItem(k)) || d; }
        function saveStorage(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
        function switchTab(id) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('text-gray-800'); b.classList.add('text-gray-400'); }); event.currentTarget.classList.add('text-gray-800'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function resetData() { if(confirm('é‡ç½®è³‡æ–™?')) { localStorage.clear(); location.reload(); } }
        function printBrochure() { window.print(); }
        async function fetchWeather(lat, lon, city) { try { const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`); const d = await r.json(); document.getElementById('w-temp').innerText = Math.round(d.current_weather.temperature); document.getElementById('weatherBoard').classList.remove('hidden'); } catch(e){} }
        
        init();
    </script>
</body>
</html>
